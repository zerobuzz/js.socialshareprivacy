/*
 * jquery.socialshareprivacy.js | 2 Klicks fuer mehr Datenschutz (1.5)
 *
 * http://www.heise.de/extras/socialshareprivacy/
 * http://www.heise.de/ct/artikel/2-Klicks-fuer-mehr-Datenschutz-1333879.html
 *
 * Copyright (c) 2011-2014 Hilko Holweg, Sebastian Hilbig, Nicolas Heiringhoff, Juergen Schmidt,
 * Heise Zeitschriften Verlag GmbH & Co. KG, http://www.heise.de
 *
 * is released under the MIT License http://www.opensource.org/licenses/mit-license.php
 *
 * Spread the word, link to us if you can.
 */
(function(g){var b=(function(){var j=document.getElementsByTagName("SCRIPT");var l="";if(j&&j.length>0){for(var k in j){if(j[k].src&&j[k].src.match(/jquery.socialshareprivacy(\.min)?\.js$/)){l=j[k].src.replace(/(.*)jquery.socialshareprivacy(\.min)?\.js$/,"$1")}}}return l})();function h(k,i){var l=decodeURIComponent(k);if(l.length<=i){return k}var j=l.substring(0,i-1).lastIndexOf(" ");l=encodeURIComponent(l.substring(0,j))+"\u2026";return l}function a(j){var i=g('meta[name="'+j+'"]').attr("content");return i||""}function c(){var j=a("DC.title");var i=a("DC.creator");if(j.length>0&&i.length>0){j+=" - "+i}else{j=g("title").text()}return encodeURIComponent(j)}function f(){var j=document.location.href;var i=g("link[rel=canonical]").attr("href");if(i&&i.length>0){if(i.indexOf("http")<0){i=document.location.protocol+"//"+document.location.host+i}j=i}return j}function d(j,l,n,m,k){var i=new Date();i.setTime(i.getTime()+(n*24*60*60*1000));document.cookie=j+"="+l+"; expires="+i.toUTCString()+"; path="+m+"; domain="+k}function e(j,l,m,k){var i=new Date();i.setTime(i.getTime()-100);document.cookie=j+"="+l+"; expires="+i.toUTCString()+"; path="+m+"; domain="+k}g.fn.socialSharePrivacy=function(i){var j={services:{facebook:{status:"on",dummy_img:"socialshareprivacy/images/dummy_facebook.png",perma_option:"on",referrer_track:"",action:"recommend",layout:"button_count",sharer:{status:"off",dummy_img:"socialshareprivacy/images/dummy_facebook_share_de.png",img:"socialshareprivacy/images/dummy_facebook_share_active_de.png"}},twitter:{status:"on",dummy_img:"socialshareprivacy/images/dummy_twitter.png",perma_option:"on",referrer_track:"",tweet_text:c,count:"horizontal"},gplus:{status:"on",dummy_img:"socialshareprivacy/images/dummy_gplus.png",perma_option:"on",referrer_track:"",size:"medium"}},info_link:"http://www.heise.de/ct/artikel/2-Klicks-fuer-mehr-Datenschutz-1333879.html",cookie_path:"/",cookie_domain:document.location.host,cookie_expires:"365",css_path:"socialshareprivacy/socialshareprivacy.css",uri:f,language:"de",lang_path:b+"/socialshareprivacy/lang/",skin:"light",alignment:"horizontal",switch_alignment:"left"};var q=g.extend(true,j,i);var o=(q.services.facebook.status==="on");var k=(q.services.facebook.sharer.status==="on");var m=(q.services.twitter.status==="on");var n=(q.services.gplus.status==="on");if(!o&&!m&&!n){return}if(q.css_path.length>0&&g(window).data("socialshareprivacy_css")!="1"){if(document.createStyleSheet){document.createStyleSheet(q.css_path)}else{g("head").append('<link rel="stylesheet" type="text/css" href="'+q.css_path+'" />')}g(window).data("socialshareprivacy_css","1")}var l;function p(){var r=g.Deferred();g.getJSON(q.lang_path+q.language+".lang",function(s){l=s;r.resolve()}).fail(function(t){if(typeof console!=="undefined"){console.log("Error "+t.status+" while loading the language file ("+q.lang_path+q.language+".lang)")}r.reject()});return r.promise()}return this.each(function(){var r=this;g.when(p()).then(function(){g(r).prepend('<ul class="social_share_privacy_area clearfix"></ul>');var w=g(".social_share_privacy_area",r);if(q.skin=="dark"){g(w).addClass("skin-dark")}if(q.alignment=="vertical"){g(w).addClass("vertical");if(q.switch_alignment=="right"&&((o&&q.services.facebook.layout=="box_count")||(!o))&&((m&&q.services.twitter.count=="vertical")||(!m))&&((n&&q.services.gplus.size=="tall")||(!n))){g(w).addClass("switch_right")}}var B=q.uri;if(typeof B==="function"){B=B(w)}if(o){var U;var t;var X=q.services.facebook.layout=="box_count"?"61":"21";var E=q.services.facebook.layout=="box_count"?"90":"130";var P=encodeURIComponent(B+q.services.facebook.referrer_track);if(k){U='<img src="'+q.services.facebook.sharer.dummy_img+'" alt="Facebook &quot;Share&quot;-Dummy" class="fb_like_privacy_dummy" />';t='<a href="#" onclick="window.open(\'https://www.facebook.com/sharer/sharer.php?u='+P+"', 'facebook-share-dialog', 'width=626,height=436'); return false;\"><img src=\""+q.services.facebook.sharer.img+'" alt="" /></a>'}else{U='<img src="'+q.services.facebook.dummy_img+'" alt="Facebook &quot;Like&quot;-Dummy" class="fb_like_privacy_dummy" />';t='<iframe src="//www.facebook.com/plugins/like.php?locale='+l.services.facebook.language+"&amp;href="+P+"&amp;width="+E+"&amp;layout="+q.services.facebook.layout+"&amp;action="+q.services.facebook.action+"&amp;show_faces=false&amp;share=false&amp;height="+X+"&amp;colorscheme="+q.skin+'" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:'+E+"px; height:"+X+'px;" allowTransparency="true"></iframe>'}w.append('<li class="facebook help_info clearfix"><span class="info">'+l.services.facebook.txt_info+'</span><a href="#" class="switch off">'+l.services.facebook.txt_fb_off+'</a><div class="fb_like dummy_btn">'+U+"</div></li>");var v=g("li.facebook",w);g(w).on("click","li.facebook div.fb_like img.fb_like_privacy_dummy,li.facebook .switch",function(Z){Z.preventDefault();if(v.find(".switch").hasClass("off")){v.addClass("info_off");v.find(".switch").addClass("on").removeClass("off").html(l.services.facebook.txt_fb_on);v.find("img.fb_like_privacy_dummy").replaceWith(t)}else{v.removeClass("info_off");v.find(".switch").addClass("off").removeClass("on").html(l.services.facebook.txt_fb_off);v.find(".fb_like").html(U)}})}if(m){var I=q.services.twitter.tweet_text;if(typeof I==="function"){I=I()}I=h(I,"120");var z=q.services.twitter.count=="horizontal"?"25":"62";var Y=q.services.twitter.count=="horizontal"?"130":"83";var O=encodeURIComponent(B+q.services.twitter.referrer_track);var J=encodeURIComponent(B);var G='<iframe allowtransparency="true" frameborder="0" scrolling="no" src="//platform.twitter.com/widgets/tweet_button.html?url='+O+"&amp;counturl="+J+"&amp;text="+I+"&amp;count="+q.services.twitter.count+"&amp;lang="+l.services.twitter.language+'&amp;dnt=true" style="width:'+Y+"px; height:"+z+'px;"></iframe>';var K='<img src="'+q.services.twitter.dummy_img+'" alt="&quot;Tweet this&quot;-Dummy" class="tweet_this_dummy" />';w.append('<li class="twitter help_info clearfix"><span class="info">'+l.services.twitter.txt_info+'</span><a href="#" class="switch off">'+l.services.twitter.txt_twitter_off+'</a><div class="tweet dummy_btn">'+K+"</div></li>");var F=g("li.twitter",w);g(w).on("click","li.twitter div.tweet img,li.twitter .switch",function(Z){Z.preventDefault();if(F.find(".switch").hasClass("off")){F.addClass("info_off");F.find(".switch").addClass("on").removeClass("off").html(l.services.twitter.txt_twitter_on);F.find("img.tweet_this_dummy").replaceWith(G)}else{F.removeClass("info_off");F.find(".switch").addClass("off").removeClass("on").html(l.services.twitter.txt_twitter_off);F.find(".tweet").html(K)}})}if(n){var A=B+q.services.gplus.referrer_track;var y='<div class="g-plusone" data-size="'+q.services.gplus.size+'" data-href="'+A+'"></div><script type="text/javascript">window.___gcfg = {lang: "'+l.services.gplus.language+'"}; (function() { var po = document.createElement("script"); po.type = "text/javascript"; po.async = true; po.src = "https://apis.google.com/js/platform.js"; var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(po, s); })(); <\/script>';var T='<img src="'+q.services.gplus.dummy_img+'" alt="&quot;Google+1&quot;-Dummy" class="gplus_one_dummy" />';w.append('<li class="gplus help_info clearfix"><span class="info">'+l.services.gplus.txt_info+'</span><a href="#" class="switch off">'+l.services.gplus.txt_gplus_off+'</a><div class="gplusone dummy_btn">'+T+"</div></li>");var L=g("li.gplus",w);g(w).on("click","li.gplus div.gplusone img,li.gplus .switch",function(Z){Z.preventDefault();if(L.find(".switch").hasClass("off")){L.addClass("info_off");L.find(".switch").addClass("on").removeClass("off").html(l.services.gplus.txt_gplus_on);L.find("img.gplus_one_dummy").replaceWith(y)}else{L.removeClass("info_off");L.find(".switch").addClass("off").removeClass("on").html(l.services.gplus.txt_gplus_off);L.find(".gplusone").html(T)}})}w.append('<li class="settings_info"><div class="settings_info_menu off perma_option_off"><a href="'+q.info_link+'"><span class="help_info icon"><span class="info">'+l.txt_help+"</span></span></a></div></li>");g(w).on("mouseenter",".help_info:not(.info_off)",function(){var Z=g(this);var aa=window.setTimeout(function(){g(Z).addClass("display")},500);g(this).data("timeout_id",aa)});g(w).on("mouseleave",".help_info",function(){var Z=g(this).data("timeout_id");window.clearTimeout(Z);if(g(this).hasClass("display")){g(this).removeClass("display")}});var M=(q.services.facebook.perma_option==="on");var Q=(q.services.twitter.perma_option==="on");var W=(q.services.gplus.perma_option==="on");if((o&&M)||(m&&Q)||(n&&W)){var S=document.cookie.split(";");var x="{";var N=0;for(;N<S.length;N+=1){var R=S[N].split("=");R[0]=g.trim(R[0].replace(/"/g,""));R[1]=g.trim(R[1].replace(/"/g,""));x+='"'+R[0]+'":"'+R[1]+'"';if(N<S.length-1){x+=","}}x+="}";x=jQuery.parseJSON(x);var C=g("li.settings_info",w);C.find(".settings_info_menu").removeClass("perma_option_off");C.find(".settings_info_menu").append('<a href="#" class="settings">'+l.settings+"</a><form><fieldset><legend>"+l.settings_perma+"</legend></fieldset></form>");var s="r"+Math.floor(Math.random()*101);var D=' checked="checked"';if(o&&M){var u=x.socialSharePrivacy_facebook==="perma_on"?D:"";C.find("form fieldset").append('<input type="checkbox" name="perma_status_facebook" id="'+s+'_perma_status_facebook"'+u+' /><label for="'+s+'_perma_status_facebook">'+l.services.facebook.perma_display_name+"</label>")}if(m&&Q){var V=x.socialSharePrivacy_twitter==="perma_on"?D:"";C.find("form fieldset").append('<input type="checkbox" name="perma_status_twitter" id="'+s+'_perma_status_twitter"'+V+' /><label for="'+s+'_perma_status_twitter">'+l.services.twitter.perma_display_name+"</label>")}if(n&&W){var H=x.socialSharePrivacy_gplus==="perma_on"?D:"";C.find("form fieldset").append('<input type="checkbox" name="perma_status_gplus" id="'+s+'_perma_status_gplus"'+H+' /><label for="'+s+'_perma_status_gplus">'+l.services.gplus.perma_display_name+"</label>")}g(w).on("click","li.settings_info .settings",function(Z){Z.preventDefault();if(g(this).data("keyb")=="on"){g("li.settings_info",w).trigger("mouseleave");g(this).data("keyb","off")}else{g("li.settings_info .settings",w).trigger("mouseenter");g(this).data("keyb","on")}});g(w).on("mouseenter","li.settings_info .settings",function(){var Z=window.setTimeout(function(){C.find(".settings_info_menu").removeClass("off").addClass("on")},500);g(this).data("timeout_id",Z)});g(w).on("mouseleave","li.settings_info",function(){var Z=g(this).data("timeout_id");window.clearTimeout(Z);C.find(".settings_info_menu").removeClass("on").addClass("off")});g(w).on("click","li.settings_info fieldset input",function(ab){var aa=ab.target.id;var Z=aa.substr(aa.lastIndexOf("_")+1,aa.length);var ac="socialSharePrivacy_"+Z;if(g("#"+ab.target.id+":checked").length){d(ac,"perma_on",q.cookie_expires,q.cookie_path,q.cookie_domain);g("form fieldset label[for="+aa+"]",w).addClass("checked")}else{e(ac,"perma_on",q.cookie_path,q.cookie_domain);g("form fieldset label[for="+aa+"]",w).removeClass("checked")}});if(o&&M&&x.socialSharePrivacy_facebook==="perma_on"){g("li.facebook .switch",w).click()}if(m&&Q&&x.socialSharePrivacy_twitter==="perma_on"){g("li.twitter .switch",w).click()}if(n&&W&&x.socialSharePrivacy_gplus==="perma_on"){g("li.gplus .switch",w).click()}}})})}}(jQuery));